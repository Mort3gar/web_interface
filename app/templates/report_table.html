{% extends 'base.html' %}

{% block content %}
    <div class="container mt-5">
        <div class="container mt-2">
            <h3 class="text-center" id="table_title">
                Сведения об исполненных заказах по гарантийному ремонту бытовой техники<br>
                За такой-то месяц такого-то года
            </h3>
        </div>
        
        <table class="table table-striped table-hover" id="table_report">
            <caption>Cd</caption>
            <thead>
            <tr>
                <th scope="col">#Код заказа</th>
                <th scope="col">ФИО клента</th>
                <th scope="col">Телефон клиента</th>
                <th scope="col">Дата поступления заказа</th>
                <th scope="col">Дата исполнения заказа</th>
                <th scope="col">Срок ремонта дней</th>
            </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Наименование товара</td>
                </tr>
                <tr>
                    <td>Фирма</td>
                </tr>
                <tr>
                    <td>Модель</td>
                </tr>
    
                <tr>
                    <td>Модель</td>
                </tr>
            <!-- Сюда будут вставляться строки с ячейками -->
            </tbody>
        </table>
    </div>

    {% block scripts_down %}
        <script type="text/javascript">
             // Функция гет запроса
             const get = async (url) => {
                const response = await axios.get(
                    url
                );
                return await response.data
            };

            async function add_data_report_table(){
                let data_report;
                // "id": item[0],
                // "client_name": item[1],
                // "phoneNumber": item[2],
                // "order_receipt_date": item[3],
                // "order_execution_date": item[4],
                // "product_name": item[5],
                // "brand_name": item[6],
                // "model": item[7],
                // "warranty_period": item[8]
                await get("/api/get_report").then(res =>{

                let data_report = res

                console.log(data)
                let table = document.getElementById(table_id);

                // Бежим по индексам даты и по ключам, вставляем соответствующие значения в таблицу
                for (let one_data in data) {
                    // счетчик строки
                    let counter = 0;

                    let new_row = table.insertRow(table.rows.length);

                    for (let key in data[one_data]) {
                        // Вставляем данные в ячейки новой строки
                        new_row.insertCell(counter).innerHTML = data[one_data][key];
                        counter++;
                    }
                    
                    // Вставляем данные в ячейки новой строки
                    new_row.insertCell(counter).innerHTML = `
                        <div class="btn-group">
                            <button type="button" class="btn btn-outline-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                                Действие
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="edit_staff?id=${data[one_data]["id"]}">Изменить</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" onclick="del_element(${data[one_data]["id"]})">Удалить</a></li>
                            </ul>
                        </div>
                    `
                }
                }).catch(error =>{
                console.log(error)
                })

                // Выполнить функцию выше при загрузке страницы
                window.onload = add_data_report_table("table_report");
            }
        </script>
    {% endblock %}

{% endblock %}