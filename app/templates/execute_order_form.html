{% extends 'base.html' %}

{% block scripts %}
{% endblock %}

{% block content %}
    <div class="container pt-3">
        <div class="container mt-5">
            <div class="border border-dark rounded p-3 m-5">
                <form id="form_execute_order">
                    <legend class="mb-3">Исполнить заказ</legend>
                    <div class="mb-3">
                        <label for="order_id" class="form-label">Номер заказа</label>
                        <input type="number" id="order_id" class="form-control" placeholder="Введите номер заказа:" required>
                    </div>
    
                    <div class="mb-3">
                        <label for="type_repair" class="form-label">Тип ремонта</label>
                        <input type="text" id="type_repair" class="form-control" placeholder="Введите тип ремонта:" required>
                    </div>
    
                    <div class="mb-3">
                        <label for="repair_cost" class="form-label">Стоимость ремонта</label>
                        <input type="number" id="repair_cost" class="form-control" placeholder="Введите стоимость ремонта:" min="0" required>
                    </div>
    
                    <div class="mb-3">
                        <label for="date_execute" class="form-label">Дата исполнения заказа</label>
                        <input type="date" id="date_execute" class="form-control" placeholder="дата исполнения" required>
                    </div>
    
                    <div class="mb-3">
                        <label for="choice_select" class="form-label">Сообщение о проделанной работе</label>
                        <select name="choice_message" id="choice_select">
                            <option value="choice_yes">Да</option>
                            <option value="choice_no">Нет</option>
                        </select>
                    </div>
    
                    <div class="mb-3">
                        <label for="receipt_date" class="form-label">Дата получения товара</label>
                        <input type="date" id="receipt_date" class="form-control" placeholder="дата получения товара">
                    </div>

                    <div>
                        <input type="button" value="Сохранить" class="btn btn-dark" onclick="add_execute_order_in_db()">
                    </div>
                </form>            
            </div>
        </div>
    </div>

    {% block scripts_down %}
        <script type="text/javascript">
            // Функции для ПОСТА
            const post = async (url, dict_) => {
                const response = await axios.post(
                    url, dict_
                );
                return await response.data
            }

            function clearInputs() {
                // Очистить поля ввода
                document.getElementById("order_id").value = "";
                document.getElementById("type_repair").value = "";
                document.getElementById("repair_cost").value = "";
            }

            // Получаем данные из формы
            function get_data_from_input(){
                let order_id = $("#order_id").val();
                let type_repair = $("#type_repair").val();
                let repair_cost = $("#repair_cost").val();

                let warranty_date = $("#date_execute").val();
                let client_name = $("#receipt_date").val();

                let choice = $("#choice_select :selected").text();

                //console.log(name, brand_name)

                return {"order_id":order_id, "type_repair":type_repair, "repair_cost":repair_cost, "warranty_date": warranty_date, 
                "client_name":client_name, "choice":choice}
            }

            async function add_execute_order_in_db(){
                // Получаем данные из формы
                let data = get_data_from_input();

                // флаг наличия пустых полей в форме
                let flag_empty = false;

                // если есть пусты поля(в том числе не выбранные даты) flag_empty=true
                for (let key in data){
                    if (data[key] === "") {
                        flag_empty = true;
                        break;
                    }
                }

                if (!flag_empty) {

                    await post("/api/add_staff", {"name": data["name"], "posts_id": data["posts_id"]}).then(res =>{
                        console.log(res)
                    }).catch(error => {
                        console.log(error)
                    })

                }
                else{
                    console.log("Не все поля заполнены!");
                }
            }

        </script>
    {% endblock %}
{% endblock %}